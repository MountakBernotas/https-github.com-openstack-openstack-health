<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Highcharts Example</title>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<style type="text/css">
${demo.css}
</style>
<script src="project_data.json"></script>
<script src="http://code.highcharts.com/stock/highstock.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/highcharts-more.js"></script>
<script src="http://code.highcharts.com/modules/solid-gauge.js"></script>
</head>
<body>

<button id="button" class"autocompare">Update</button>
<div id="timegraph" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
<table id="jobtable">
<tr><td>Failures</td><td>Job Name</td><td>Run Time</td><td>Passed</td><td>Failed</td><td>%Failed</td>
</table>
<script type="text/javascript">
var data = JSON.parse(project_data);

$(function () {

    $('#timegraph').highcharts('StockChart',{
        title: {
            text: 'Nova Jobs',
            x: -20 //center
        },
        xAxis: {
            categories: []
        },
        yAxis: {
            title: {
                text: 'Counts'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
    });
});

$('#button').click(function() {
var range = new Array();
var pass = new Array();
var fail = new Array();
var jobs = new Array();

for (var ele=0; ele < data.timedata.length; ele++) {
    var obj = data.timedata[ele];
    range[ele]=obj.datetime;
    var n_fail = 0;
    var n_pass = 0;
    for (var loop=0; loop < obj.job_data.length; loop++) {
        var job = obj.job_data[loop].job_name;
        n_fail += obj.job_data[loop].fail;
        n_pass += obj.job_data[loop].pass;
        var found = 0;
        for (loop2=0; loop2 < jobs.length; loop2++) {
            if (jobs[loop2].job_name === job) {
                found = 1;
                jobs[loop2].fail += obj.job_data[loop].fail;
                jobs[loop2].pass += obj.job_data[loop].pass;
                jobs[loop2].fail_sparc_data.push(obj.job_data[loop].fail);
                jobs[loop2].run_time_sparc_data.push(obj.job_data[loop].mean_run_time);
            }
        }
        if (found === 0) {
            jobs.push({job_name: job, pass: obj.job_data[loop].pass, fail: obj.job_data[loop].fail, fail_sparc_data:[obj.job_data[loop].fail], run_time_sparc_data:[obj.job_data[loop].mean_run_time]});
        }
    }
    pass[ele] = n_pass;
    fail[ele] = n_fail;
}

    var tgraph = $('#timegraph').highcharts();
    while(tgraph.series.length > 0)
        tgraph.series[0].remove(true);
    tgraph.addSeries({name: "Pass", data: pass});
    tgraph.addSeries({name: "Failed", data: fail});
    tgraph.xAxis[0].setCategories(range);
    tgraph.redraw();
    var ttable=$('#jobtable').find('tbody');
    for (var loop=0; loop<jobs.length; loop++) {
        pct = ( jobs[loop].fail * 100 ) / (jobs[loop].fail + jobs[loop].pass);
        ttable.append($('<tr>')
            .append($('<td><div id="fail_sparc_'+loop+'" style="height:100px"></div></td>'))
            .append($('<td>'+jobs[loop].job_name+'</td>'))
            .append($('<td><div id="runtime_sparc_'+loop+'" style="height:100px"></div></td>'))
            .append($('<td>'+jobs[loop].pass+'</td>'))
            .append($('<td>'+jobs[loop].fail+'</td>'))
            .append($('<td>'+pct+'</td></tr>'))
        );
        $('#fail_sparc_'+loop).highcharts({
            title: { text: ' ' },
            subtitle: { text: ' '},
            xAxis: { lineWidth: 0, minorGridLineWidth: 0, lineColor: 'transparent', title: { text: ' ' }, labels: { enabled: false }},
            yAxis: { lineWidth: 0, minorGridLineWidth: 0, lineColor: 'transparent', title: { text: ' ' }, labels: { enabled: false }},
            series: [{name: ' ', data: jobs[loop].fail_sparc_data}],
            plotOptions: {line: { marker: { enabled: false } } },
            height: 100,
            width: 150
        });
        $('#runtime_sparc_'+loop).highcharts({
            title: { text: ' ' },
            subtitle: { text: ' '},
            xAxis: { lineWidth: 0, minorGridLineWidth: 0, lineColor: 'transparent', title: { text: ' ' }, labels: { enabled: false }},
            yAxis: { lineWidth: 0, minorGridLineWidth: 0, lineColor: 'transparent', title: { text: ' ' }, labels: { enabled: false }},
            series: [{name: ' ', data: jobs[loop].run_time_sparc_data}],
            plotOptions: {line: { marker: { enabled: false } } },
            height: 100,
            width: 150
        });
    }
});
</script>
</body>
</html>
